<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>青柠学优</title>
  <subtitle>要有目标，不要瞎干，坚持，坚持，坚持</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wupengfei1987.github.io/"/>
  <updated>2016-11-10T13:54:17.000Z</updated>
  <id>https://wupengfei1987.github.io/</id>
  
  <author>
    <name>wupengfei</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>note-2016-11-10</title>
    <link href="https://wupengfei1987.github.io/post/note-2016-11-10/"/>
    <id>https://wupengfei1987.github.io/post/note-2016-11-10/</id>
    <published>2016-11-10T13:53:31.000Z</published>
    <updated>2016-11-10T13:54:17.000Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>发工资了 </li>
</ul>
]]></content>
    
    <summary type="html">
    
      日记
    
    </summary>
    
      <category term="日记" scheme="https://wupengfei1987.github.io/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
      <category term="日记" scheme="https://wupengfei1987.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>天堂电影院</title>
    <link href="https://wupengfei1987.github.io/post/%E5%A4%A9%E5%A0%82%E7%94%B5%E5%BD%B1%E9%99%A2/"/>
    <id>https://wupengfei1987.github.io/post/天堂电影院/</id>
    <published>2016-11-10T03:20:22.000Z</published>
    <updated>2016-11-10T03:28:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="天堂电影院"><a href="#天堂电影院" class="headerlink" title="天堂电影院"></a>天堂电影院</h1><blockquote>
<p>纪念我的爱莲娜</p>
</blockquote>
<p>1992年冬天，在大学外教楼六楼某映室，我第一次看[天堂电影院]，也是迄今为止惟一的一次。一部好电影，你只需要看一次就能铭记一生。 </p>
<p>那个1992年，是我念大学的第一年。漫长而可恶的军训过后，回到校园时已是冬天。成都的冬天又湿又冷。宿舍里没有暖气——准确地说，那时候我连“暖气”的概念都没有，扎堆看电影是我们最喜欢的取暖行动。 </p>
<p>很多超经典的片子作为教学用的教材被引入校园。所以，1989年正式公映的[天堂电影院]，虽然在3年后才观赏到，但在当时，我也算是最早看到这部片子的人之一了。毕竟中国执行国外大片分账引进制度大概是1994年。 </p>
<p>现在是2009年2月10日。元宵时分。北京。 </p>
<p>我坐在书桌的电脑前，第一次为[天堂电影院]写下一些文字。 </p>
<p>16年已经过去了。 </p>
<p>这16年里发生了很多事，从成都到广州再到香港再到北京；从一个媒体狂热分子变成了一个媒体疲倦分子；从理想主义者沦落为抑郁症患者；从恋爱、结婚到失恋、失婚……身边，人来人往，聚散别离随时随地演出着，生生死死，葬礼连着喜宴……我尝到了身不由己的悲哀，亦曾经是别人生命中的无奈。这样的似水流年，到了此刻，当下，[天堂电影院]依然在心头。 </p>
<p>只有仅仅看过一次的[天堂电影院]还不动声色地蛰伏在心灵的某处——每一个人物，每一个片断、每一个细节，包括男主人公多多在黑暗中泪光闪烁的样子，包括女主人公艾琳娜金发蓝眸无与伦比的清丽样子——清晰如昨。<br>虽然每一年都有许多好片子公映，可我想讲一句可能有失公允的话，请别批评我——我想说，[天堂电影院]，是我迄今为上看过的最饱满的一部电影。 </p>
<p>事实上，这16年来，我屡屡萌生出要为它写点什么的念头，可这念头一产生，心却空下去，立刻不知从何说起。正如此刻我的叽叽歪歪，大有找不到主题的慌乱。 </p>
<p>我一直在寻找这种失语症的病源，现在，好像有了一个不太确定的答案：或许，那些年里自己的人生阅历尚浅，即使被[天堂电影院]感动到无法忘怀，却空有感动；我不能领悟的实在太多，不得不失语。不得不长期失语。 </p>
<p>假如，我还没有栽够跟头并且以为跟头的“裁”已经到此为止；假如，我从未为自己的梦想付出过惨痛的代价；假如我最珍爱着的，从未被命运以难以容忍的方式夺走；假如，我没有全心全意地爱过、痛过、失魂过；假如，我从未惊觉到身边那些令我不耐烦的家伙竟然一直在默默为我付出……那么，就算我此时把[天堂电影院]夸得像一大把玫瑰花，那也只能是一大把苍白的玫瑰花！ </p>
<p>玫瑰花如此苍白，没有一朵像[天堂电影院]里红色的理想。 </p>
<p>前几天，我在网络上读到某个“80后”网友很诚实的话，他说他“也曾尝试耐心的看完它”，“始终无法融入电影营造的那个氛围中去”。 </p>
<p>我还读到一个影迷极简短的评价，他说：“这是一部又长又闷，感动得让我流泪的片子”。 </p>
<p>说得真！讲得好！[天堂电影院]的确是一部又长又闷、节奏慢得要死的电影！ </p>
<p>如果16年前的那个冬天不是又冷又湿，如果我们不是为了扎堆取暖，我发誓，我必定错过它没商量。</p>
<p>坐在人群中取暖的我们，是面无表情地、极度平静地、有一搭没一搭地看着这部电影，看着看着看着看着，崩溃了。<br>接下来，又一次崩溃；接下来，再一次崩溃…… </p>
<p>当成年的多多把自己关在房间里静静地看着30年前初见艾琳娜时为她录下的那段影像，银幕上，他的眼里闪烁着泪光。我突然意识到四周相当安静，原本讲小话的同学仿佛消失于黑暗。我挪动了一下身子，略环顾四周——神啊！在阶梯放映室里，在我的左边，在我的右边，在我的身后，一排一排的同学们，一排一排的泪光，一排一排地，在黑暗中闪闪发光。<br>那样的一幕，16年来成为了[天堂电影院]无法割裂的一个部分，深深地刻在我的记忆中。 </p>
<p>请允许我重复这个故事，因为我是从16年前的记忆里重复它，就像背书。</p>
<p>有一个小朋友叫沙什么图什么多。我们管他叫“多多”。 </p>
<p>他出生在西西里的什么加村。那是个偏僻而且闭塞的小镇，在它外面战火正蔓延，小镇却无比平静，平静得非常无聊。战争对于多多而言，只是“令他失去父爱”的王八蛋。 </p>
<p>多多很小就给镇上惟一一座教堂里的惟一一位神父当灵童。 </p>
<p>影片的开头，神父在教堂里做弥撒；多多用小手支着小腮帮子打瞌睡。我们看到这里全笑了。 </p>
<p>惟一的教堂前面（还是旁边？或者后面？）是这个小镇惟一的电影院，其状如古堡，并不雄壮地“耸立”在西西里的蓝天下。<br>艾佛特是电影院的王，作为小镇里惟一一个会放电影的人，他就是施予居民快乐的王。 </p>
<p>神父做完弥撒便会到<em>河蟹</em>院里审片。只要影片里出现接吻镜头，他就怒气冲冲地摇响手里的铃；放映间的艾佛特立刻抄起一张纸夹在胶片里，事后，他会把所有被神父PASS掉的镜头全部剪下来。 </p>
<p>小小的多多躲在门后跟神父一起“审片”，那些接吻的镜头在让神父火冒三丈的同时却令他眉开眼笑。他蹭到艾佛特身边，求他把剪下的胶片送给他。老艾佛特恶狠狠地吼他：他可以把剪下的胶片送给他，但他立刻“滚回家”去。 </p>
<p>多多在“滚回家”前，总要偷偷地抓一把散落在放映室门口的胶片带回去。 </p>
<p>他在煤油灯下看着他的宝贝，嘴里开着枪“邦邦邦”。</p>
<p>“先发射，后思考！”他说。 </p>
<p>有一天，多多随神父为死者作完法事，正走在回家的路上。老艾佛特骑着自行车从他们身边晃过，搭讪了几句。多多立刻躺地上，假装脚扭了。老艾佛特一眼看穿了他的把戏，但他还是把小多多放到前座上送他回家。</p>
<p>多多对老人说：“我们应该成为朋友。” </p>
<p>老艾佛特讲出了本片第一句名言，大意是他通过外表选朋友，通过智慧先敌人，多多太狡猾，不适合做朋友。 </p>
<p>这句话一语成谶。到了最后，多多生命中最铁的老友也是他最狠的敌人。 </p>
<p>多多特别喜欢看电影。就像我们一样。 </p>
<p>其实，那个小镇里没有人不喜欢看电影，电影是他们独一无二的娱乐。 </p>
<p>简陋的电影院有个极诗意的名字“天堂”。 </p>
<p>“天堂”里聚集着一群乡巴佬，粗鄙不堪。其中貌似最文明的那位，坐在二楼第一排，总喜欢故意往楼下吐痰。</p>
<p>我们知道他是故意的。 </p>
<p>多多把妈妈给他买牛奶的几十里拉买了电影票。母亲在影院外等了他一整天，见到他就是一场追打。 </p>
<p>艾佛特刚巧出来看见，告诉多多妈，多多看电影是免费的，那些钱一定落在电影院了，然后他问旁边的同事，他打扫电影院的时候找到那些钱了没有？</p>
<p>同事一件一件从口袋里趴拉出一堆废物，直到艾佛特变戏法似地从中“抽出”钱还给多多妈。 </p>
<p>多多藏在铁盒里的胶片被妹妹搜出来玩，却意外地引起了火灾。多多妈痛打他一顿，并责怪艾佛特不教他好！<br>可是多多仍然溜到放映室里找艾佛特，他甚至表演放映技巧给艾佛特看，原来，小小的多多已经偷师成功，成了小镇上第二个会放电影的人了。 </p>
<p>随着社会的进步（！呵呵），影片里终于出现了接吻的镜头，观众沸腾了！他们热烈的鼓掌。神父气哼哼地说：“我不看<em>河蟹</em>。”这一句，我印象深刻，它曾经泛滥在我们的宿舍里。 </p>
<p>随后，电影院因为播放了违禁镜头被停业了。“天堂”门前的广场上聚集着大帮居民，他们要求看电影。</p>
<p>“满足他们吗？”艾佛特问多多。 多多点点头。 结果，电影打在一整幅墙上。广场上的人们欣喜若狂。 </p>
<p>电影院老板指使手下收半价票。居民们乐滋滋地回答他：“为什么？广场是大家的！” </p>
<p>这时，长期住在广场里的流浪汉兼疯子正在一柱子上睡觉。他一跃而起，大喝一声：“不！广场是我的！” </p>
<p>这是小镇上有史以来第一次放映露天电影。 </p>
<p>艾佛特要多多也去体会一下看露天电影的感觉。 </p>
<p>多多欢喜地跑下去。这时，灾难发生了，放映室胶片起火，艾佛特被喷出的火苗袭击，晕倒在房间里。</p>
<p>大家四散逃窜，只有多多——小小的多多拼命冲进放映室，把昏迷的老艾佛特救了出来。</p>
<p>“天堂”被烧毁。人们站在广场上看着它的断壁残垣，沮丧得很。怎么办？惟一的娱乐没有了！怎么办？ </p>
<p>因为中彩票暴富的齐齐欧（这名字让我想起了格格巫）回来了。他出资新建了电影院，就在老影院的废墟上，取名还是“天堂”。 </p>
<p>天堂电影院重新开张。多多接替艾佛特成了小镇上的放映员。</p>
<p>被大火烧瞎了眼睛的艾佛特，在妻子的帮助下来到新放映室。现在，轮到他陪多多放电影了，就像多多一直做的那样。 </p>
<p>本来很反感多多泡电影的妈妈也松了口，毕竟多多放电影可以拿到薪水帮衬家用。 </p>
<p>多多在日复一日的放映中渐渐长成了英俊少年。 </p>
<p>齐齐欧扩大了“天堂”的生意，在邻村也建了一座电影院。可胶片只有一卷，所以，他的儿子（？）骑着车往返于两个村庄之间送换胶片。那一天，这小子终于烦了，临时放了老爸“鸽子”。居民们等不到影片快爆了。没办法，多多只好骑上自行车来找他。 </p>
<p>在一棵大树下，多多看见那小王八蛋，裤子撸到脚跟，正趴在一老女人身上“嘿咻”“嘿咻”！<br>他看见多多，大声喊着：“走开！”一边更大声地喊：“好爽！”<br>多多打量着他们，拿起胶片赶回电影院。<br>电影院里的影片不止可以有吻戏，祼戏也放禁了。<br>银幕上，碧姬的裸体光滑诱人。坐在前排的一帮小子们情不自禁“打手枪”，被现场监督员一巴掌打乱春梦。<br>“你们的手都老实点！”那男人吼道。可银幕上的春光让他的脐下三寸也不自觉地勃起…… </p>
<p><em>河蟹</em>就在电影院里“办公”，所有被镜头撩拨得<em>河蟹</em>十足的男人都是她的客人。生意爆棚！电影散场后，多多在这个<em>河蟹</em>的身上终结了自己的处男身。<br>多多新买了一架摄像机。他拍的第一部影像关于屠宰场。<br>他拍的第二部影像关于一个女孩。<br>金发蓝眸的艾琳娜进入他的镜头。精致的轮廓、清丽无匹的气质扰乱了多多平静的心。他被这个女孩迷住了。<br>为了接近艾琳娜，他跟其他爱慕者大打出手。相思之苦折磨着他。多多打电话到艾琳娜家，迫不急待的衷肠诉尽，电话那头传来一个女人的声音质问他是谁——那不是艾琳娜，是艾琳娜的老妈！<br>艾琳娜告诉多多：“我喜欢你，但我不爱你。”<br>多多惨遭打击。 </p>
<p>艾佛特对多多讲了一个故事，他说：有一次，国王为美丽的公主开宴会，有个士兵在一旁站岗。看到公主经过他面前，她是绝色佳人，他立刻爱上了她。但卑微的士兵怎能配上国王的女儿。有一天，他终于设法接近她，并告诉她没有她就活不下去。公主被他的深情所感动，她告诉士兵，“如果你能等我100天，且日日夜夜在阳台下等我，百日之后，我就是你的。”<br>听了这话，士兵真在阳台下等，一天，两天，十天……他都站在那里等他，任由风吹雨，任凭鸟把屎拉在他的身上。士兵又累又饿，但没有什么能动摇他。 </p>
<p>公主一直注视着士兵。就这样过了98天。到了第99天，士兵突然站起身，拎起凳子走了。他害怕。他怕到了第100天，公主对他说她不爱他…… </p>
<p>大意是这样吧。16年了，我记得不是很清楚了。<br>这个故事多多完全听不懂。他对艾琳娜的爱情越来越炙热，如火如荼。<br>在教堂里，多多看见艾琳娜站在忏悔室窗口前，便央求艾佛特帮他拖住神父。多多趁人不注意钻进忏悔室，对着艾琳娜讲了一大堆情话。<br>她被他逗乐了。于是，他们约会。 </p>
<p>接下来，我看到了这部冗长的影片里最灿烂的几个片断，全部关于他与她的约会。<br>他们深深地相爱，一个银行经理的女孩和一个贫民区里的男孩。这般阶层悬殊的爱情必定是会遭到毒手的！果然，艾琳娜的妈妈不顾一切地要搬家，企图从物理空间阻止他们进一步发展。<br>多多和艾琳娜约定在天堂电影院广场前的沙滩上见面。<br>那天，焦急的多多久等着艾琳娜，他决定了，一旦艾琳娜出现，他就带她私奔。 </p>
<p>可艾琳娜迟迟没来。<br>迫不急待的多多把放映室的工作托付给艾佛特，开着一辆借来的车冲刺到艾琳娜家。一路跌跌撞撞，车几乎成了废铁！<br>他拼命地捶着她家大门。<br>门紧闭着。悄无回应。 </p>
<p>失魂落魄的多多回到电影院。他一生中最美的梦破灭了。<br>随后，多多服兵役。<br>他写给艾琳娜的信总是原封不动的退回。一封两封三四封无数封……<br>多多的脾气变得很暴戾。他不断地被关禁闭。<br>当他行尸走肉般躺在病床上时，战友告诉他，他终于退伍了。<br>一无所有、身心交瘁的多多回到了西西里的那个村庄。 </p>
<p>在多多从军的那段时间里，老艾佛特把自己关在房间，不肯跟人讲话，也不肯外出。多多回来了，他重新活过来。他要多多陪他去“看看”海。<br>这一老一小坐在海边。他们之间的对话，与我的呼吸共存。<br>老艾佛特劝多多离开村子，要是他总待在这里将一事无成，可他只要离开，哪怕仅一两年，一切都会改变。<br>老艾佛特说：“线断了。一切都物事人非。你必须离开。”<br>老艾佛特批评多多，说他比他还瞎。<br>老艾佛特要多多出去“捞世界”，他不想跟他在这里浪费时间，他想听到周围的人都在谈讨多多。<br>老艾佛特和多多妈、多多妹把多多送上了开往罗马的火车。<br>老艾佛特警告多多，如果没有成就，他永远别想回来。 </p>
<p>30年过去了。多多在罗马混得风生水起。他没有回过村子，一次都没有，直到母亲通过电话间接（好像是一个女人接了）告诉他：老艾佛特去世了。他应该回来参加他的葬礼。<br>今天，类似接了多多电话的那个女人，我们有一个很妙的称呼，她是多多的“炮友”。<br>著名导演多多回到了村庄。<br>艾佛特收集了他导演的所有的电影海报。在电视里、在电影院里，他倾听关于他的消息和他的电影。<br>多多走进逝去的艾佛特简洁的小屋：墙上挂着的是他的电影的剧照，桌上摆着的是他的照片……艾佛特的妻子告诉多多，直到临死前，艾佛特还挂念着他。 </p>
<p>给艾佛特送殡的路上，多多遇见了许多熟人。齐齐欧已经两鬓班白，他告诉多多，由于电视的普及，天堂电影院已经没了市场，<em>河蟹</em>收购了它，准备将戏院炸毁改建成停车场。<br>办理完艾佛特的丧事后，多多并没有马上回罗马。他总是隐隐地感觉到一种召唤，是艾琳娜在呼唤他吗？<br>路边，一个黑发蓝眸的女孩清丽无匹，仿佛艾琳娜重现。<br>对艾琳娜无时无刻无所不在的如影随行的思念，被这个女孩唤醒。<br>多多把自己关在房间里。老式放映机“沙沙”作响；墙壁上，美丽的艾琳娜顾盼生辉。然而，黑白色的灰度镜像告诉我们：那是30年前的影像！ </p>
<p>璀璨的泪花盛开在多多的眼睛里——我尚未看到哪个男人可以有过如此绝美的情感的绽放。<br>多多的妈妈推开门，默默注视着心爱的儿子，百感交集。<br>多多妈已经是位衰老的妇人。自从丈夫死后，她一直寡居。<br>她告诉多多，每一次她给他去电话，总是不同的女人在接听。她明白如果自己的儿子不是没遇到至爱的人，就是心有所系。<br>她告诉多多，她一生中只爱过一个男人，那就是多多的爸爸，所以，她能够体会多多的心情。<br>她告诉多多，在他服兵役前，在他跟艾琳娜恋爱的时候，每一个晚上，她都会留门，躺在床上倾听着屋外的动静；当多多回了家，她会悄悄地起来把房门锁好。 </p>
<p>她告诉多多，在他当上镇里的放映员后，每个晚上她都不能入睡，她总会在锁眼里插上一把钥匙，她怕自己突然睡过去，她怕儿子进不了家门。<br>多多默默地听着妈妈絮絮叨叨，他从来就不曾知道：原来母亲一直这么牵挂着他。<br>多多尾随黑发蓝眸的女孩到了她家门外。他看见女孩跟自己的父亲出门。她的父亲，竟然是当年曾跟多多打过架的艾琳娜的某个追求者。<br>多多在电话亭打电话。<br>对面的房间，窗帘映出一个女人的身影。<br>“是我。”他几乎窒息的模样。 </p>
<p>“哦？”她平静地回答，“是你呀。我想起来了。”<br>他们相约当晚在海边见面。<br>他站在海边。那里，他曾陪艾佛特最后一次听海。<br>她开着车来了。车灯仿佛穿越了时空从30年前照过来，照亮了眼前方寸间的黑暗。<br>多多走进艾琳娜的车厢。30年前，她清丽的脸庞浮现眼前。<br>“你还是那么美。”</p>
<p>“老了。”艾琳娜自嘲着。<br>老了。美丽的艾琳娜！惟一不肯老去的，是她的蓝眸。她的眼睛，大大的，明亮的，湛蓝的。<br>她说她结婚了，除了一个女儿，还有一个儿子。她说她生活得很好。一切都过去了。<br>多多突然激动起来，问她，怎么可以这样？他一直在等他，等了30年！<br>他问她：为什么那天晚上让他苦苦等待？为什么她不来？<br>她去过放映室找他。艾琳娜惊讶地看着多多。她去了。她只是迟到了。<br>她苦苦哀求父母，才得以见他一面。她去到放映室时，他不在。艾佛特对她说多多让他转告她，他已经放弃了他们之间的感情。 </p>
<p>艾琳娜被多多的无情惨痛一击。但她还是在一张纸上留下了她朋友的地址，希望多多写信给他。<br>那个时候，多多正开了辆破车冲到她家门前，疯狂地拍打着她的家门。<br>艾佛特没有告诉他她曾来过。<br>艾佛特为什么会对她撒谎？<br>震惊的多多大脑一片空白。<br>艾琳娜告诉他，那时候她已经决定了心意，只要见到他，她就跟他一起私奔！<br>震惊的多多大脑一片空白。他转过身去，紧紧地抱着艾琳娜。<br>很久以前，我的初恋男友曾对我说过一句话，他说，男人都很可怜，当他们拥有爱情时，却没有钱，没有名声；可等他们有钱有名声了，他们的爱人却嫁给了别人，没准已经“绿树成荫子满枝”了。<br>疯了似的多多赶到天堂电影院，在放映室里——在一片灰尘和狼藉里，找着艾琳娜留给他的纸条。<br>纸条上写着：她永远爱他。<br>物是，人非。 </p>
<p>在艾佛特家里。他的妻子交给多多一盒胶片。她说，艾佛特临终前要她把它交给他。她不知道这胶片里记录了什么。<br>她回忆着艾佛特生前的点点滴滴，他为多多骄傲，他是多么地想念多！可艾佛特从未提出让多多回来见他一面的要求。从未，直到死去！<br>多多又一次给艾琳娜电话，他希望她跟他一起去罗马。<br>艾琳娜回答他，一切都过去了。昨夜紧紧地相拥只是一个美梦。拥有这样美丽的梦，她已知足。她告诉多多，她一直关注着他的成就，她看他拍出的每一部电影，她听所有关于他的新闻。可一切都过去了。<br>广场上再一次聚满了人群。天堂电影院在爆炸声里轰然倒塌。<br>广场上聚集的人群有着截然不同的表情。齐齐欧们满面悲伤；艾琳娜的女儿和她的同学们轻松地笑着，似乎很高兴看到一个旧时代的彻底终结。 </p>
<p>随着爆炸声响，多多情不自禁地颤抖；与此同时，站在自家窗前的艾琳娜，情不自禁地颤抖。<br>回到罗马的多多立刻陷入了忙碌。<br>他的秘书告知他获奖的消息。多多无动于衷。他把艾佛特留给他的胶片递给放映员让他播放，然后，他走进审片室。<br>灯熄了，胶片在放映机上徐徐转动。一幕幕曾被老神父PASS掉的镜头接踵而至：他吻了她；他吻了她；她吻了他；她又吻了她；她在镜头前猛然撕开衣服，露出美丽的<em>河蟹</em>……<br>多多噙着泪水，在黑暗中，在光影交错中，微笑着。<br>这就是令我们魂牵梦萦的[天堂电影院]。<br>冗长乏味的节奏，一个镜头接着一个镜头……正如你和我和他和她的人生际遇。<br>16年前的那个冬天，多么阴冷潮湿！一群扎堆取暖的小青年占领了外教楼第五层的阶梯放映室。[天堂电影院]正在放映。<br>我们冷静地看着，间或讲讲小话，打个情骂个俏，干笑数声，有一搭没一搭，都懒得付出些许情绪，压根就事不关己。<br>可是，到了某处，整个人崩溃了。<br>一次一次又一次，崩溃。 </p>
<p>有一个好友跟我讲起吉塞贝-多纳托雷的[西西里美丽传说]和[海上钢琴师]，那时，他眉飞色舞，口惹悬河。<br>我盯着他，好一会儿。<br>“怎么啦？”他问。<br>“你没看过[天堂电影院]吗？吉塞贝的[天堂电影院]。”<br>他茫然，摇头。<br>我没说出口的是：就算你已经看过了[飘]、[教父]系列、[红白蓝]系列、[罗生门]、[沉默的羔羊]、[西线无战事]、[七宗罪]……但你没有看过[天堂电影院]，那么，电影是什么？电影到底是什么？估计，难有答案吧。</p>
<p>16年来，[天堂电影院]帮助我一一解开人生的难题。<br>16年后，[天堂电影院]告诉我：电影，是上帝留在人间的天堂。<br>当我们被逐出伊甸园，饱尝痛苦、无奈、悲伤和孤独，电影，就是那幅珍贵的地图，它为我们指出回家的路。 </p>
<p>谨以此文献给酷爱[天堂电影院]的你</p>
]]></content>
    
    <summary type="html">
    
      天堂电影院 影评
    
    </summary>
    
      <category term="电影" scheme="https://wupengfei1987.github.io/categories/%E7%94%B5%E5%BD%B1/"/>
    
    
      <category term="电影、影评" scheme="https://wupengfei1987.github.io/tags/%E7%94%B5%E5%BD%B1%E3%80%81%E5%BD%B1%E8%AF%84/"/>
    
  </entry>
  
  <entry>
    <title>e-book</title>
    <link href="https://wupengfei1987.github.io/post/e-book/"/>
    <id>https://wupengfei1987.github.io/post/e-book/</id>
    <published>2016-11-10T02:22:29.000Z</published>
    <updated>2016-11-10T03:16:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="书"><a href="#书" class="headerlink" title="书"></a>书</h1><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p>​     </p>
<table>
<thead>
<tr>
<th style="text-align:center">图片</th>
<th style="text-align:center">下载</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="https://img1.doubanio.com/lpic/s8990957.jpg" alt="Spring框架高级编程"></td>
<td style="text-align:center"><a href="http://share.weiyun.com/6b28064831b677c88f64068ae75f528b" target="_blank" rel="external">链接</a>  微信：wupengfeizhijia</td>
</tr>
</tbody>
</table>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><h3 id="IOS"><a href="#IOS" class="headerlink" title="IOS"></a>IOS</h3><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><h3 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h3><h3 id="文学"><a href="#文学" class="headerlink" title="文学"></a>文学</h3>]]></content>
    
    <summary type="html">
    
      书
    
    </summary>
    
      <category term="书" scheme="https://wupengfei1987.github.io/categories/%E4%B9%A6/"/>
    
    
      <category term="pdf" scheme="https://wupengfei1987.github.io/tags/pdf/"/>
    
  </entry>
  
  <entry>
    <title>2016-11-06 note</title>
    <link href="https://wupengfei1987.github.io/post/2016-11-06-note/"/>
    <id>https://wupengfei1987.github.io/post/2016-11-06-note/</id>
    <published>2016-11-06T09:21:53.000Z</published>
    <updated>2016-11-06T09:50:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2016-11-06-note"><a href="#2016-11-06-note" class="headerlink" title="2016-11-06 note"></a>2016-11-06 note</h1><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ol>
<li>ActionLogManage</li>
<li>zookeeper  了解 </li>
<li>​</li>
</ol>
<h3 id="DO"><a href="#DO" class="headerlink" title="DO"></a>DO</h3><ol>
<li><p>install thrift  on Mac   </p>
<p><img src="http://a2.qpic.cn/psb?/V1269BGv0nUzim/bCxrq3bkYpN5Bc4OShiJXrCUdgC7sr3ESiLqEzBRSkk!/b/dNwAAAAAAAAA&amp;bo=OgLEAQAAAAAFB9k!&amp;rf=viewer_4" alt="thrif"></p>
<p>​</p>
</li>
<li><p>sk</p>
</li>
<li><p>3</p>
</li>
<li><p>4</p>
<p>​</p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      日记
    
    </summary>
    
      <category term="日记" scheme="https://wupengfei1987.github.io/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
      <category term="TODO" scheme="https://wupengfei1987.github.io/tags/TODO/"/>
    
  </entry>
  
  <entry>
    <title>note 2016-10-26</title>
    <link href="https://wupengfei1987.github.io/post/note-2016-10-26/"/>
    <id>https://wupengfei1987.github.io/post/note-2016-10-26/</id>
    <published>2016-10-26T09:11:43.000Z</published>
    <updated>2016-10-26T09:11:43.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>note 16/10/25</title>
    <link href="https://wupengfei1987.github.io/post/note-16-10-25/"/>
    <id>https://wupengfei1987.github.io/post/note-16-10-25/</id>
    <published>2016-10-25T01:50:36.000Z</published>
    <updated>2016-10-26T08:34:05.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>杂记 </p>
</blockquote>
<ul>
<li>vim /etc/sysconfig/iptables ; service iptables start/stop/restart</li>
<li>cd -  // 最近两个目录互相切换  </li>
<li>ln -s  /application/nginx-1.6.3/ /application/nginx //创建软连接</li>
<li>tail -f /data/logs/access.log  // tail  最后一行 </li>
<li>ps aux | grep tomcat   // 查看 tomcat </li>
<li>kill -9 18923  // 杀死 进程 </li>
<li>history &gt; history.log   // 在 root 权限下 </li>
<li>zip -r tomcat-7.0.zip tomcat-7.0/*    // 压缩</li>
<li>unzip tomcat-7.0.zip  // 解压缩</li>
<li>scp tomcat-7.0.zip  work@120.76.237.141:/home/work/   // 把 zip 包 上传到 远程服务器 </li>
<li>听老周讲店长直聘的方向 </li>
</ul>
]]></content>
    
    <summary type="html">
    
      日记
    
    </summary>
    
      <category term="日记" scheme="https://wupengfei1987.github.io/categories/%E6%97%A5%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>wings_admin_login</title>
    <link href="https://wupengfei1987.github.io/post/wings-admin-login/"/>
    <id>https://wupengfei1987.github.io/post/wings-admin-login/</id>
    <published>2016-10-22T15:21:48.000Z</published>
    <updated>2016-10-22T15:26:17.000Z</updated>
    
    <content type="html"><![CDATA[<hr>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/login"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">toLogin</span><span class="params">(HttpServletRequest request,</span></span></div><div class="line">                            HttpServletResponse response) &#123;</div><div class="line">    ModelAndView mv = <span class="keyword">new</span> ModelAndView();</div><div class="line">    mv.setViewName(<span class="string">"login"</span>);</div><div class="line">    <span class="keyword">return</span> mv;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><blockquote>
<p>暂时没有 </p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      web
    
    </summary>
    
      <category term="wings" scheme="https://wupengfei1987.github.io/categories/wings/"/>
    
    
      <category term="wings_admin_user" scheme="https://wupengfei1987.github.io/tags/wings-admin-user/"/>
    
  </entry>
  
  <entry>
    <title>wings_user_update_command</title>
    <link href="https://wupengfei1987.github.io/post/wings-user-update-command/"/>
    <id>https://wupengfei1987.github.io/post/wings-user-update-command/</id>
    <published>2016-10-21T13:54:57.000Z</published>
    <updated>2016-10-21T14:02:27.000Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>用户基本资料更新接口</p>
</blockquote>
<h1 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ApiMethod</span>(<span class="string">"user.update"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> ApiResult <span class="title">update</span><span class="params">(User user, @ApiParam(value = <span class="string">"name"</span>, required = <span class="keyword">false</span>)</span> String name,</span></div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"avatar"</span>, required = <span class="keyword">false</span>)</span> String avatar,</div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"gender"</span>, required = <span class="keyword">false</span>)</span> Integer gender,</div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"birthday"</span>, required = <span class="keyword">false</span>)</span> String birthdayStr,</div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"address"</span>, required = <span class="keyword">false</span>)</span> String address,</div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"cityCode"</span>, required = <span class="keyword">false</span>)</span> Integer cityCode,</div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"lng"</span>, required = <span class="keyword">false</span>)</span> Double lng,</div><div class="line">                        @<span class="title">ApiParam</span><span class="params">(value = <span class="string">"lat"</span>, required = <span class="keyword">false</span>)</span> Double lat) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        UserInfo userInfo = <span class="keyword">new</span> UserInfo();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (StringUtils.isBlank(birthdayStr)) &#123;</div><div class="line">            birthdayStr = <span class="string">"20000101"</span>;</div><div class="line">        &#125;</div><div class="line">        Date birthday = DateUtils.parseDateTime(birthdayStr, <span class="string">"yyyyMMdd"</span>);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(name))</div><div class="line">            <span class="keyword">if</span> (name.length() &lt; <span class="number">2</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_PARAM);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        userInfo.setUserId(user.getId());</div><div class="line">        userInfo.setIdentity(user.getIdentity());</div><div class="line">        userInfo.setName(name);</div><div class="line">        userInfo.setAvatar(avatar);</div><div class="line">        userInfo.setGender(gender==UserInfo.GENDER_FEMALE?UserInfo.GENDER_FEMALE:UserInfo.GENDER_MALE);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != birthday) &#123;</div><div class="line">            userInfo.setBirthday(birthday);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(address)) &#123;</div><div class="line">            userInfo.setAddress(address);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (lng != <span class="keyword">null</span>) &#123;</div><div class="line">            userInfo.setLng(lng);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (lat != <span class="keyword">null</span>) &#123;</div><div class="line">            userInfo.setLat(lat);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (cityCode != <span class="keyword">null</span> &amp;&amp; cityCode &gt; <span class="number">0</span>) &#123;</div><div class="line">            userInfo.setCityCode(cityCode);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> count = userInfoService.addOrUpdateUserInfo(userInfo);</div><div class="line">        <span class="keyword">if</span> (count &lt; <span class="number">1</span>) &#123;</div><div class="line">            logger.error(<span class="string">"modify user info error,userId=&#123;&#125;"</span>, user.getId());</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_BIZ_MODIFY_USERINFO_FAIL);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.SUCCESS, ErrorCode.SUCCESS);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logger.error(<span class="string">"RPC error "</span> + e);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_RPC_ERROR);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>.</div><div class="line">    <span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addOrUpdateUserInfo</span><span class="params">(UserInfo userInfo)</span> </span>&#123;</div><div class="line">		<span class="comment">//查询用户信息是否存在，存在则更新，不存在则新增</span></div><div class="line">		<span class="keyword">int</span> count = -<span class="number">99</span>;</div><div class="line">		UserInfo dbUserInfo = <span class="keyword">this</span>.getByUserId(userInfo.getUserId());</div><div class="line">		<span class="keyword">if</span> (!StringUtils.isEmpty(userInfo.getAvatar())) &#123;</div><div class="line">			<span class="comment">//如果照片存在，则移除url中的前缀</span></div><div class="line">			userInfo.setAvatar(userInfo.getAvatar().replaceAll(SiteConfig.getString(SiteConfig.KEY_SITE_IMAGE_URL) , <span class="string">""</span>));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (dbUserInfo == <span class="keyword">null</span>) &#123;</div><div class="line">			count = <span class="keyword">this</span>.userInfoDAO.addUserInfo(userInfo);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			count = <span class="keyword">this</span>.userInfoDAO.updateUserInfo(userInfo);</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//更新缓存</span></div><div class="line">		cacheService.del(getCacheUserKey(userInfo.getUserId()));</div><div class="line">		<span class="keyword">return</span> count;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="number">2</span>.</div><div class="line">  </div><div class="line">    <span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> UserInfo <span class="title">getByUserId</span><span class="params">(<span class="keyword">long</span> userId)</span> </span>&#123;</div><div class="line">		String key = getCacheUserKey(userId);</div><div class="line">		UserInfo userInfo = cacheService.get(key, UserInfo.class);</div><div class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == userInfo)&#123;</div><div class="line">			userInfo = <span class="keyword">this</span>.userInfoDAO.getByUserId(userId);</div><div class="line">			<span class="keyword">if</span>(<span class="keyword">null</span> != userInfo)&#123;</div><div class="line">				User user = userDAO.queryById(userId);</div><div class="line">				<span class="keyword">if</span>(<span class="keyword">null</span> != user) &#123;</div><div class="line">					userInfo.setMobile(user.getMobile());</div><div class="line">				&#125;</div><div class="line">				userInfo.setGenderDesc(<span class="keyword">this</span>.domainService.getDomValue(DomTypeCode.GENDER_CODE, userInfo.getGender()));</div><div class="line">				userInfo.setAvatar(SiteConfig.getString(SiteConfig.KEY_SITE_IMAGE_URL) + userInfo.getAvatar());</div><div class="line">				City city = cityService.queryCityByCode(userInfo.getCityCode());</div><div class="line">				<span class="keyword">if</span> (<span class="keyword">null</span> != city) &#123;</div><div class="line">					userInfo.setCityName(city.getName());</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">int</span> certStatus = userCertificationService.getCertificationStatus(userId, user.getIdentity());</div><div class="line">				userInfo.setCertStatus(certStatus);</div><div class="line">				cacheService.set(key, userInfo, ConstantCache.TIME_TEN_MINUTES);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> userInfo;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      app api
    
    </summary>
    
      <category term="wings" scheme="https://wupengfei1987.github.io/categories/wings/"/>
    
    
      <category term="wings_command_user" scheme="https://wupengfei1987.github.io/tags/wings-command-user/"/>
    
  </entry>
  
  <entry>
    <title>wings_user_login_command</title>
    <link href="https://wupengfei1987.github.io/post/wings-user-login-command/"/>
    <id>https://wupengfei1987.github.io/post/wings-user-login-command/</id>
    <published>2016-10-21T13:37:16.000Z</published>
    <updated>2016-10-21T13:51:38.000Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>用户登陆功能</p>
</blockquote>
<h1 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h1><p>​    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ApiMethod</span>(value = <span class="string">"user.login"</span>, auth = ApiMethod.Auth.OPTION)</div><div class="line"><span class="function"><span class="keyword">public</span> ApiResult <span class="title">execute</span><span class="params">(@ApiParam(<span class="string">"name"</span>)</span> String name,</span></div><div class="line">                         @<span class="title">ApiParam</span><span class="params">(<span class="string">"password"</span>)</span> String password) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line"></div><div class="line">        User user = userService.login(name, password);</div><div class="line"></div><div class="line">        Map&lt;String, Object&gt; retMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">        Session session = userService.updateUserSession(user, UserTicket.ORIGIN_APP);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (session == <span class="keyword">null</span>) &#123;</div><div class="line">            logger.error(<span class="string">"gen user=&#123;&#125;,login session null"</span>, user.getId());</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.FAIL);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        retMap.put(<span class="string">"uid"</span>, user.getId());</div><div class="line">        retMap.put(<span class="string">"identity"</span>, user.getIdentity());</div><div class="line">        retMap.put(<span class="string">"secretKey"</span>, session.getSecretKey());</div><div class="line"></div><div class="line">        user = userService.queryById(user.getId());</div><div class="line"></div><div class="line">        retMap.put(<span class="string">"userInfo"</span>, user.getUserInfo());</div><div class="line"></div><div class="line">        retMap.put(<span class="string">"t"</span>, session.getTicket());</div><div class="line"></div><div class="line">        <span class="comment">//TODO  teacher info  and  parent info</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.SUCCESS, retMap);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">catch</span> (UserExcpetion ue) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (ue.code == UserExcpetion.FREEZ) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_BIZ_USER_FREEZED);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ue.code == UserExcpetion.PASSWORD_ERROR) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_BIZ_LOGIN_WRONG_PASSWORD);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ue.code == UserExcpetion.USERNAME_NOTEXIST) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_BIZ_LOGIN_NO_ACCOUNT);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_RPC_ERROR);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logger.error(<span class="string">"RPC error "</span>, e);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_RPC_ERROR);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line"><span class="number">1</span>.</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Session <span class="title">updateUserSession</span><span class="params">(User user, <span class="keyword">int</span> origin)</span> </span>&#123;</div><div class="line">        Session session = SessionUtil.createSession(user.getId(), user.getPassword());</div><div class="line">        String ticket = session.getTicket();</div><div class="line">        UserTicket userTicket = userTicketDAO.queryByUserIdAndOrigin(user.getId(), origin);</div><div class="line">        String secretKey = SecurityUtils.genSecretKey();</div><div class="line">        session.setSecretKey(secretKey);</div><div class="line">        <span class="keyword">int</span> rs;</div><div class="line">        <span class="keyword">if</span> (userTicket == <span class="keyword">null</span>) &#123;</div><div class="line">            userTicket = <span class="keyword">new</span> UserTicket();</div><div class="line">            userTicket.setUserId(user.getId());</div><div class="line">            userTicket.setSecretKey(secretKey);</div><div class="line">            userTicket.setOrigin(origin);</div><div class="line">            userTicket.setTicket(ticket);</div><div class="line">            rs = userTicketDAO.insertUserTicket(userTicket);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            userTicket.setTicket(ticket);</div><div class="line">            rs = userTicketDAO.updateUserPassport(userTicket, secretKey);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rs &gt; <span class="number">0</span>) &#123;</div><div class="line">            cacheService.set(getPassportCacheKey(user.getId(), origin), session,    ConstantCache.TIME_ONE_DAY);</div><div class="line">            <span class="keyword">return</span> session;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@SQL</span>(<span class="string">"SELECT "</span> + COLUMNS + <span class="string">" FROM "</span> + TABLE_NAME + <span class="string">" WHERE user_id=:1 AND origin=:2"</span>)</div><div class="line">	<span class="function">UserTicket <span class="title">queryByUserIdAndOrigin</span><span class="params">(<span class="keyword">long</span> userId, <span class="keyword">int</span> origin)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@ReturnGeneratedKeys</span></div><div class="line">	<span class="meta">@SQL</span>(<span class="string">"INSERT INTO "</span>+TABLE_NAME+<span class="string">" (user_id,origin,ticket,secret_key,create_time,update_time) VALUES"</span> +</div><div class="line">			<span class="string">"(:t.userId,:t.origin,:t.ticket,:t.secretKey,NOW(),NOW())"</span>)</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insertUserTicket</span><span class="params">(@SQLParam(<span class="string">"t"</span>)</span> UserTicket ticket)</span>;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="meta">@SQL</span>(<span class="string">"UPDATE "</span>+TABLE_NAME +<span class="string">" SET ticket=:t.ticket,secret_key=:sk ,update_time =NOW()  WHERE user_id=:t.userId AND origin=:t.origin"</span>)</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">updateUserPassport</span><span class="params">(@SQLParam(<span class="string">"t"</span>)</span> UserTicket ticket, @<span class="title">SQLParam</span><span class="params">(<span class="string">"sk"</span>)</span> String secretKey)</span>;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="number">2</span>.</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">        String key = getCacheUserKey(id);</div><div class="line">        User user = cacheService.get(key, User.class);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == user) &#123;</div><div class="line">            user = userDAO.queryById(id);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != user) &#123;</div><div class="line">                user.setIdentityDesc(<span class="keyword">this</span>.domainService.getDomValue(DomTypeCode.IDENTITY_TYPE_CODE, user.getIdentity()));</div><div class="line">                user.setStatusDesc(<span class="keyword">this</span>.domainService.getDomValue(DomTypeCode.USER_STATUS_CODE, user.getStatus()));</div><div class="line">                user.setUserInfo(<span class="keyword">this</span>.userInfoService.getByUserId(id));</div><div class="line">                cacheService.set(key, user, ConstantCache.TIME_TEN_MINUTES);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> user;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   <span class="number">2.1</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDomValue</span><span class="params">(String domainTypeCode, Integer domKey)</span> </span>&#123;</div><div class="line">        String value = <span class="string">""</span>;</div><div class="line">        Domain domain = <span class="keyword">this</span>.queryByDomTypeCodeAndKey(domainTypeCode, domKey);</div><div class="line">        <span class="keyword">if</span> (domain != <span class="keyword">null</span>) &#123;</div><div class="line">            value = domain.getDomValue();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Domain <span class="title">queryByDomTypeCodeAndKey</span><span class="params">(String domainTypeCode, Integer domKey)</span> </span>&#123;</div><div class="line">        String key = domainTypeCode.concat(String.valueOf(domKey));</div><div class="line">        Domain domain = cacheService.get(key, Domain.class);</div><div class="line">        <span class="keyword">if</span> (domain == <span class="keyword">null</span>) &#123;</div><div class="line">            domain = <span class="keyword">this</span>.domainDAO.queryByDomTypeCodeAndKey(domainTypeCode, domKey);</div><div class="line">            <span class="keyword">if</span> (domain != <span class="keyword">null</span>) &#123;</div><div class="line">                cacheService.set(key, domain, ConstantCache.TIME_TOW_DAYS);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> domain;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="number">2.2</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> UserInfo <span class="title">getByUserId</span><span class="params">(<span class="keyword">long</span> userId)</span> </span>&#123;</div><div class="line">		String key = getCacheUserKey(userId);</div><div class="line">		UserInfo userInfo = cacheService.get(key, UserInfo.class);</div><div class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == userInfo)&#123;</div><div class="line">			userInfo = <span class="keyword">this</span>.userInfoDAO.getByUserId(userId);</div><div class="line">			<span class="keyword">if</span>(<span class="keyword">null</span> != userInfo)&#123;</div><div class="line">				User user = userDAO.queryById(userId);</div><div class="line">				<span class="keyword">if</span>(<span class="keyword">null</span> != user) &#123;</div><div class="line">					userInfo.setMobile(user.getMobile());</div><div class="line">				&#125;</div><div class="line">				userInfo.setGenderDesc(<span class="keyword">this</span>.domainService.getDomValue(DomTypeCode.GENDER_CODE, userInfo.getGender()));</div><div class="line">				userInfo.setAvatar(SiteConfig.getString(SiteConfig.KEY_SITE_IMAGE_URL) + userInfo.getAvatar());</div><div class="line">				City city = cityService.queryCityByCode(userInfo.getCityCode());</div><div class="line">				<span class="keyword">if</span> (<span class="keyword">null</span> != city) &#123;</div><div class="line">					userInfo.setCityName(city.getName());</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">int</span> certStatus = userCertificationService.getCertificationStatus(userId, user.getIdentity());</div><div class="line">				userInfo.setCertStatus(certStatus);</div><div class="line">				cacheService.set(key, userInfo, ConstantCache.TIME_TEN_MINUTES);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> userInfo;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="number">2.2</span>.1</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> City <span class="title">queryCityByCode</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> cityDAO.queryCityByCode(code);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="number">2.2</span>.2</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCertificationStatus</span><span class="params">(<span class="keyword">long</span> userId, <span class="keyword">int</span> identity)</span> </span>&#123;</div><div class="line">        UserCertification userCertification = getUserCertification(userId, identity);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>==userCertification? UserCertification.STATUS_INIT:userCertification.getStatus();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> UserCertification <span class="title">getUserCertification</span><span class="params">(<span class="keyword">long</span> userId, <span class="keyword">int</span> identity)</span> </span>&#123;</div><div class="line">        String key = getUserCertificationKey(userId, identity);</div><div class="line">        UserCertification userCertification = cacheService.get(key, UserCertification.class);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == userCertification) &#123;</div><div class="line">            userCertification = userCertificationDAO.getByUserId(userId, identity);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != userCertification) &#123;</div><div class="line">                cacheService.set(key, userCertification, ConstantCache.TIME_ONE_DAY);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> userCertification;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      app
    
    </summary>
    
      <category term="wings" scheme="https://wupengfei1987.github.io/categories/wings/"/>
    
    
      <category term="wings_command_user" scheme="https://wupengfei1987.github.io/tags/wings-command-user/"/>
    
  </entry>
  
  <entry>
    <title>wings_user_register_command</title>
    <link href="https://wupengfei1987.github.io/post/wings-user-register-command/"/>
    <id>https://wupengfei1987.github.io/post/wings-user-register-command/</id>
    <published>2016-10-21T12:33:31.000Z</published>
    <updated>2016-10-21T13:58:58.000Z</updated>
    
    <content type="html"><![CDATA[<hr>
<blockquote>
<p>用户注册功能</p>
</blockquote>
<h1 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ApiMethod</span>(value = <span class="string">"user.register"</span>, auth = ApiMethod.Auth.OPTION)</div><div class="line"><span class="function"><span class="keyword">public</span> ApiResult <span class="title">execute</span><span class="params">(ApiCommandContext apiCommandContext,</span></span></div><div class="line">                         @ApiParam(<span class="string">"mobile"</span>) String mobile, </div><div class="line">                         @<span class="title">ApiParam</span><span class="params">(<span class="string">"password"</span>)</span> String password,</div><div class="line">                         @<span class="title">ApiParam</span><span class="params">(<span class="string">"code"</span>)</span> String code) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        User user = <span class="keyword">new</span> User();</div><div class="line">        <span class="keyword">if</span> (!RegexUtils.isPhone(mobile)) &#123;</div><div class="line">            logger.error(<span class="string">"illegal mobile=&#123;&#125;"</span>, mobile);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_PARAM);</div><div class="line">        &#125;</div><div class="line">        password = StringUtils.trimToEmpty(password);</div><div class="line">        <span class="keyword">if</span> (!password.matches(<span class="string">"[a-zA-Z0-9\\-+_~!@#$%^&amp;*()=]&#123;6,20&#125;"</span>)) &#123;</div><div class="line">            logger.error(<span class="string">"password too simple or illegal password=&#123;&#125;"</span>, password);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_PARAM);</div><div class="line">        &#125;</div><div class="line">        user.setMobile(mobile);</div><div class="line">        user.setPassword(password);</div><div class="line">        user.setUserName(mobile);</div><div class="line">        user.setIdentity(User.IDENTITY_INIT);</div><div class="line">        User oldUser = userService.queryByMobile(mobile);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != oldUser) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_BIZ_ACCOUNT_EXIST);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> id = userService.addUser(user);</div><div class="line">        <span class="keyword">if</span> (id &gt; <span class="number">0</span>) &#123;</div><div class="line">            user.setId(id);</div><div class="line">            Session session = userService.updateUserSession(user, UserTicket.ORIGIN_APP);</div><div class="line">            <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</div><div class="line">                Map&lt;String, Object&gt; retMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">                retMap.put(<span class="string">"t"</span>, session.getTicket());</div><div class="line">                retMap.put(<span class="string">"uid"</span>, session.getUserId());</div><div class="line">                retMap.put(<span class="string">"secretKey"</span>, session.getSecretKey());</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.SUCCESS, retMap);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.FAIL);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            logger.error(<span class="string">"create user error,mobile=&#123;&#125;,id=&#123;&#125;"</span>, mobile, id);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.FAIL);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        logger.error(<span class="string">"RPC error "</span>, e);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiResult(ErrorCode.E_SYS_RPC_ERROR);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">   </div><div class="line"><span class="number">1</span>.</div><div class="line">   <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryByMobile</span><span class="params">(String mobile)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> userDAO.queryByMobile(mobile);</div><div class="line">    &#125;</div><div class="line">   </div><div class="line"></div><div class="line">    </div><div class="line"><span class="number">2</span>. </div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addUser</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        String salt = getSalt();</div><div class="line">        user.setSalt(salt);</div><div class="line">        user.setPassword(getPassword(user.getPassword(), salt));</div><div class="line">        user.setStatus(User.STATUS_OK);</div><div class="line">        user.setUserName(StringUtils.trimToEmpty(user.getUserName()));</div><div class="line">        user.setEmail(StringUtils.trimToEmpty(user.getEmail()));</div><div class="line">        user.setMobile(StringUtils.trimToEmpty(user.getMobile()));</div><div class="line">        <span class="keyword">int</span> id = userDAO.insertUser(user);</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line"></div><div class="line"><span class="number">3</span>. </div><div class="line">  </div><div class="line">   <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Session <span class="title">updateUserSession</span><span class="params">(User user, <span class="keyword">int</span> origin)</span> </span>&#123;</div><div class="line">        Session session = SessionUtil.createSession(user.getId(), user.getPassword());</div><div class="line">        String ticket = session.getTicket();</div><div class="line">        UserTicket userTicket = userTicketDAO.queryByUserIdAndOrigin(user.getId(), origin);</div><div class="line">        String secretKey = SecurityUtils.genSecretKey();</div><div class="line">        session.setSecretKey(secretKey);</div><div class="line">        <span class="keyword">int</span> rs;</div><div class="line">        <span class="keyword">if</span> (userTicket == <span class="keyword">null</span>) &#123;</div><div class="line">            userTicket = <span class="keyword">new</span> UserTicket();</div><div class="line">            userTicket.setUserId(user.getId());</div><div class="line">            userTicket.setSecretKey(secretKey);</div><div class="line">            userTicket.setOrigin(origin);</div><div class="line">            userTicket.setTicket(ticket);</div><div class="line">            rs = userTicketDAO.insertUserTicket(userTicket);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            userTicket.setTicket(ticket);</div><div class="line">            rs = userTicketDAO.updateUserPassport(userTicket, secretKey);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (rs &gt; <span class="number">0</span>) &#123;</div><div class="line">            cacheService.set(getPassportCacheKey(user.getId(), origin), session, ConstantCache.TIME_ONE_DAY);</div><div class="line">            <span class="keyword">return</span> session;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      app
    
    </summary>
    
      <category term="wings" scheme="https://wupengfei1987.github.io/categories/wings/"/>
    
    
      <category term="wings_command_user" scheme="https://wupengfei1987.github.io/tags/wings-command-user/"/>
    
  </entry>
  
  <entry>
    <title>first post</title>
    <link href="https://wupengfei1987.github.io/post/first-post/"/>
    <id>https://wupengfei1987.github.io/post/first-post/</id>
    <published>2016-10-20T17:29:46.000Z</published>
    <updated>2016-10-20T17:33:06.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>青柠学优  </p>
</blockquote>
<ul>
<li>ksks</li>
<li>lskd</li>
<li>上课理发师看的 </li>
</ul>
<ol>
<li>是肯德基法拉盛</li>
<li>lsjdfkas </li>
<li>是理科生地方</li>
</ol>
]]></content>
    
    <summary type="html">
    
      青柠学优
    
    </summary>
    
      <category term="Android" scheme="https://wupengfei1987.github.io/categories/Android/"/>
    
    
      <category term="博客，文章" scheme="https://wupengfei1987.github.io/tags/%E5%8D%9A%E5%AE%A2%EF%BC%8C%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
</feed>
